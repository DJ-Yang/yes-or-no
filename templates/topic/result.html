{% extends 'base.html' %}

{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static 'css/result.css' %}">
<link rel="stylesheet" href="{% static 'css/result_chart.css' %}">
<script type="text/javascript">
    var postive = "{{ result.postive }}";
    var negative = "{{ result.negative }}";
</script>
{% endblock %}

{% block content %}
<div class="topic">
    <div class="topic-title">
        {{ topic.title }}
    </div>
    <div class="topic-graph-wrap">
        <div class="label-agree" style="width:{{topic.get_count_yes}};">{{topic.get_count_yes}}</div>
        <div class="label-disagree">{% if topic.get_count_no != '0%'%}{{topic.get_count_no}}{%endif%}</div>
        <div class="agree" style="width: {{topic.get_count_yes}};">
        </div>
    </div>
    <div class="description">
        <div class="sel1">{{topic.selection1_des}}</div>
        <div class="sel2">{{topic.selection2_des}}</div>
    </div>
    <div class="edit">
        <a href="#">
            <!-- <img src="{% static 'img/cycle.png' %}" width="25px"> -->
            다시투표하기
        </a>
    </div>
    <div class="topic-thumb">
        <img src="{{topic.thumb_image.url}}">
    </div>

    <div class="share-sns">
        <div class="title">
            <img src="{% static 'img/share.png' %}" width="20px">
            공유하기
        </div>
        <div class="button">
            <a href="javascript:;" id="kakao-link-btn">
                <img src="{% static 'img/kakao_share.png' %}" width="45px">
            </a>
            <!-- <img src="{% static 'img/naver_share.png' %}" width="45px"> -->
            <span>
                <script type="text/javascript" src="https://ssl.pstatic.net/share/js/naver_sharebutton.js"></script>
                <script type="text/javascript">
                    var currentURL = window.location.href;
                    var buttonURL = currentURL.replace('result/', '');
                    new ShareNaver.makeButton({ "type": "f", "title": "'{{ topic.title }}'", "url": buttonURL });
                </script>
            </span>
        </div>
    </div>
</div>
<div class="topic-analysis">
    <div class="topic-analysis-box">
        <div class="title">
            차트1
        </div>
        <div class="chart1">
            <div>
                <ul>
                    <li class="week active">주간</li>
                    <li class="month">월간</li>
                    <li class="year">연간</li>
                </ul>
            </div>
            <div class="canvas-container1">
                <canvas width="100%" height="100%" id="chart1" class="chart1"></canvas>
            </div>
        </div>
    </div>
    <div class="topic-analysis-box">
        <div class="title">
            차트2
        </div>
        <div class="chart2">
            <div>
                <ul>
                    <li class="all active">전체</li>
                    <li class="age">연령대</li>
                    <li class="gender">성별</li>
                </ul>
            </div>
            <div class="canvas-container2">
                <div class="all-chart">
                    <div class="chart-title" style="display: flex;">
                        <div class="female">여자</div>
                        <div class="male">남자</div>
                    </div>
                    <div class="chart-row">
                        <div class="data" data="female-10">
                            <div class="agree"></div>
                        </div>
                        <div class="legend">10대</div>
                        <div class="data" data="male-10">
                            <div class="agree"></div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="data" data="female-10">
                            <div class="agree"></div>
                        </div>
                        <div class="legend">20대</div>
                        <div class="data" data="male-10">
                            <div class="agree"></div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="data" data="female-10">
                            <div class="agree"></div>
                        </div>
                        <div class="legend">30대</div>
                        <div class="data" data="male-10">
                            <div class="agree"></div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="data" data="female-10">
                            <div class="agree"></div>
                        </div>
                        <div class="legend">40대</div>
                        <div class="data" data="male-10">
                            <div class="agree"></div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="data" data="female-10">
                            <div class="agree"></div>
                        </div>
                        <div class="legend">50대</div>
                        <div class="data" data="male-10">
                            <div class="agree"></div>
                        </div>
                    </div>
                </div>
                <!-- <canvas width="100%" height="100%" id="chart2" class="chart2"></canvas> -->
            </div>
        </div>
    </div>
</div>
{% endblock %}



{% block extra_js %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.4.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script type="text/javascript">

    function chart_all() {
        

    }

    function chart_gender() {
        let male_data = [{
            data: [40, 60],
            labels: ["1", "2"],
            backgroundColor: [
                "#FFDE50",
                "#646464",
            ],
            borderColor: "#fff"
        }];
        let male_options = {
            responsive: false,
            legend: {
                display: true,
                labels: {
                    fontColor: 'rgb(255, 99, 132)'
                }
            },
            plugins: {
                datalabels: {
                    formatter: function (value, ctx) {
                        let datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                            let sum = datasets[0].data.reduce(function (a, b) { return a + b; }, 0);
                            let percentage = Math.round((value / sum) * 100) + '%';
                            return percentage;
                        } else {
                            return percentage;
                        }
                    },
                    color: '#fff',
                }
            },
            tooltips: {
                enabled: false
            }
        };

        let female_data = [{
            data: [40, 60],
            labels: ["1", "2"],
            backgroundColor: [
                "#FFDE50",
                "#646464",
            ],
            borderColor: "#fff"
        }];
        let female_options = {
            responsive: false,
            legend: {
                display: true,
                labels: {
                    fontColor: 'rgb(255, 99, 132)'
                }
            },
            plugins: {
                datalabels: {
                    formatter: function (value, ctx) {
                        let datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                            let sum = datasets[0].data.reduce(function (a, b) { return a + b; }, 0);
                            let percentage = Math.round((value / sum) * 100) + '%';
                            return percentage;
                        } else {
                            return percentage;
                        }
                    },
                    color: '#fff',
                }
            },
            tooltips: {
                enabled: false
            }
        };

        let ctx = document.getElementById("chart2-male").getContext('2d');
        console.log(ctx);
        let chart = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: male_data
            },
            options: male_options
        });
        let ctx2 = document.getElementById("chart2-female").getContext('2d');
        let chart2 = new Chart(ctx2, {
            type: 'pie',
            data: {
                datasets: female_data
            },
            options: female_options
        });
    }


    function chart_age() {

        new Chart(document.getElementById("chart2"), {
            type: 'bar',
            data: {
                labels: ['10대', '20대', '30대', '40대', '50대'],
                datasets: [{
                    label: '찬성',
                    backgroundColor: '#FFDE50',
                    data: [20, 10, 20, 23, 15]
                }, {
                    label: '반대',
                    backgroundColor: '#646464',
                    data: [12, 24, 20, 0, 10]
                }]
            },
            options: {
                maintainAspectRatio: false,
                title: {
                    display: false,
                    // text: ''
                },
                tooltips: {
                    enabled: false
                },
                responsive: true,
                scales: {
                    xAxes: [{
                        stacked: false
                    }],
                    yAxes: [{
                        stacked: false
                    }]
                },
                plugins: {
                    datalabels: {
                        align: 'top',
                        anchor: 'end',
                        backgroundColor: function (context) {
                            return context.dataset.backgroundColor;
                        },
                        borderRadius: 4,
                        color: 'white',
                        formatter: function (value) {
                            return value;
                        }
                    }
                }
            }
        });
    }

    function chart_date(date) {
        let data = [{
            data: [100, 60],
            labels: ["1", "2"],
            backgroundColor: [
                "#FFDE50",
                "#646464",
            ],
            borderColor: "#fff"
        }];
        let options = {
            legend: {
                display: true,
                labels: {
                    fontColor: 'rgb(255, 99, 132)'
                }
            },
            plugins: {
                datalabels: {
                    formatter: function (value, ctx) {
                        let datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                            let sum = datasets[0].data.reduce(function (a, b) { return a + b; }, 0);
                            let percentage = Math.round((value / sum) * 100) + '%';
                            return percentage;
                        } else {
                            return percentage;
                        }
                    },
                    color: '#fff',
                }
            },
            tooltips: {
                enabled: false
            }
        };
        create_datechart(data, options, 'pie');
    }

    function create_datechart(data, options, type) {
        let ctx1 = document.getElementById("chart1").getContext('2d');
        let chart1 = new Chart(ctx1, {
            type: 'pie',
            data: {
                datasets: data
            },
            options: options
        });
    }
</script>
<script src="{% static 'js/result.js' %}"></script>
{% endblock %}