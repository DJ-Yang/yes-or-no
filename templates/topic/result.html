{% extends 'base.html' %}

{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static 'css/result.css' %}">
<script type="text/javascript">
    var postive = "{{ result.postive }}";
    var negative = "{{ result.negative }}";
</script>
{% endblock %}

{% block content %}
<div class="topic">
    <div class="topic-title">
        {{ topic.title }}
    </div>
    <div class="topic-graph-wrap">
        <div class="label-agree" style="width:{{topic.get_count_yes}};">{{topic.get_count_yes}}</div>
        <div class="label-disagree">{% if topic.get_count_no != '0%'%}{{topic.get_count_no}}{%endif%}</div>
        <div class="agree" style="width: {{topic.get_count_yes}};">
        </div>
    </div>
    <div class="description">
        <div class="sel1">{{topic.selection1_des}}</div>
        <div class="sel2">{{topic.selection2_des}}</div>
    </div>
    <div class="edit">
        <a href="#">
            <!-- <img src="{% static 'img/cycle.png' %}" width="25px"> -->
            다시투표하기
        </a>
    </div>
    <div class="topic-thumb">
        <img src="{{topic.thumb_image.url}}">
    </div>

    <div class="share-sns">
        <div class="title">
            <img src="{% static 'img/share.png' %}" width="20px">
            공유하기
        </div>
        <div class="button">
            <a href="javascript:;" id="kakao-link-btn">
                <img src="{% static 'img/kakao_share.png' %}" width="45px">
            </a>
            <!-- <img src="{% static 'img/naver_share.png' %}" width="45px"> -->
            <span>
                <script type="text/javascript" src="https://ssl.pstatic.net/share/js/naver_sharebutton.js"></script>
                <script type="text/javascript">
                var currentURL = window.location.href;
                var buttonURL = currentURL.replace('result/', '');
                new ShareNaver.makeButton({"type": "f" , "title":"'{{ topic.title }}'" , "url":buttonURL});
                </script>
            </span>
        </div>
    </div>
</div>
<div class="topic-analysis">
    <div class="topic-analysis-box">
        <div class="title">
            분석 1
        </div>
        <div class="chart">
            <canvas width="100%" height="100%" id="myChart"></canvas>
        </div>
    </div>
    <div class="topic-analysis-box">
        <div class="title">
            분석 2
        </div>
        <div class="chart">
            <canvas width="100%" height="100%" id="myChart2"></canvas>
        </div>
    </div>
</div>
{% endblock %}



{% block extra_js %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.4.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script type="text/javascript">
    var data = [{
        data: [40, 60],
        labels: ["1", "2"],
        backgroundColor: [
            "#FFDE50",
            "#646464",
        ],
        borderColor: "#fff"
    }];
    var options = {
        legend: {
            display: true,
            labels: {
                fontColor: 'rgb(255, 99, 132)'
            }
        },
        plugins: {
            datalabels: {
                formatter: function (value, ctx) {
                    let datasets = ctx.chart.data.datasets;
                    if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                        let sum = datasets[0].data.reduce(function (a, b) { return a + b; }, 0);
                        let percentage = Math.round((value / sum) * 100) + '%';
                        return percentage;
                    } else {
                        return percentage;
                    }
                },
                color: '#fff',
            }
        },
        tooltips: {
            enabled: false
        }
    };

    var ctx = document.getElementById("myChart").getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            datasets: data
        },
        options: options
    });

    var ctx2 = document.getElementById("myChart2").getContext('2d');
    var myChart = new Chart(ctx2, {
        type: 'pie',
        data: {
            datasets: data
        },
        options: options
    });
</script>
<script type="text/javascript">
    var currentURL = window.location.href;
    var buttonURL = currentURL.replace('result/', '');
    Kakao.Link.createDefaultButton({
        container: '#kakao-link-btn',
        objectType: 'feed',
        content: {
          title: '{{ topic.title }}',
          description: '{{ topic.description }}',
        //   imageUrl: 'http://127.0.0.1:8000{{topic.thumb_image.url}}',
          imageUrl: 'http://mud-kage.kakao.co.kr/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png',
          link: {
            mobileWebUrl: buttonURL,
            webUrl: buttonURL
          }
        },
        social: {
          likeCount: 286,
          commentCount: 45,
          sharedCount: 845
        },
        buttons: [
          {
            title: '웹으로 보기',
            link: {
              mobileWebUrl: buttonURL,
              webUrl: buttonURL
            }
          },
          {
            title: '앱으로 보기',
            link: {
              mobileWebUrl: buttonURL,
              webUrl: buttonURL
            }
          }
        ]
      });
    </script>
{% endblock %}